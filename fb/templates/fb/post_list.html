{% load static %}
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="icon"  href="/static/css/fb1.png" type="image/gif" sizes="16x16">
        <title>facebook</title>
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <link href='//fonts.googleapis.com/css?family=Lobster&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="{% static 'css/fb.css' %}">
        
        <script src="{% static 'js/jquery.min.js' %}"></script>
        <script src="{% static 'js/jquery.waypoints.min.js' %}"></script>
        <script src="{% static 'js/infinite.min.js' %}"></script>
          

     
       <script type="text/javascript">
        function showcomments(value){
          $(".comment"+value).toggle()
         }

        function upload() {
         $("#upload").show()
        }
       </script>
      
        
    </head>
    <body>
        <nav class="navbar navbar-default" >

            <div class="container-fluid" style="background-color: #4267b2;">
                <div class="navbar-header">
                    <a class="navbar-brand" style="color:white;">facebook</a>
                </div>
               
                <ul class="nav navbar-nav navbar-right">
                    {% if user.is_authenticated %}

                    
                      <li ><a href="{% url 'profile' %}"class="top-menu" style="color: white;"><img class="img-circle" src="{{ user.profile.image.url }}" height="30px" width="35px" />&nbsp{{ user.username }}</a></li>
                       <li><a href="{% url 'edit_profile' %}" class="top-menu" style="color:white;" >Edit profile</a></li>

                      <li><a href="{% url 'logout' %}" class="top-menu" style="color:white;" >logout</a></li>


                     {% else %}
                         <li><a href="{% url 'login' %}" class="top-menu" style="color: white;">login</a></li>
                         <li><a href="{% url 'register' %}" class="top-menu" style="color: white;">Register</a></li>
                    {% endif %}
                </ul>
            </div>
    </nav>
  
       
        <div class="container">
            <div class="row">
               <div class="col-md-3 sidenav">
                {% if user.is_authenticated %}
               
                   <h4>{{ user.username }}</h4>
                    <ul class="nav nav-pills nav-stacked">
                     <li class="active"><a href="">Home</a></li>
                     <li><a href="#section2">Messanger</a></li>
                     <li><a href="#section3">Friends</a></li>
                     <li><a href="#section3">Photos</a></li>
                      
                      <h5>shortcuts</h5>
                      <li class=""><a href="">Helath and inspriational videos</a></li>
                     <li><a href="#section2">Messanger</a></li>
                     <li><a href="#section3">Friends</a></li>
                     <li><a href="#section3">Photos</a></li>
                      </ul><br>
                      {% endif %}

                </div>
                
                <div class="col-md-6">

                    {% if user.is_authenticated %}
                     <form name="myform" method="POST" action="{% url 'create_post' %}" autocomplete="off" enctype="multipart/form-data">  
                        {% csrf_token %}
                       <input id="post"  type="text" name="post"  placeholder="  write something here !!!" /><br><br>
                        <label><span class="glyphicon glyphicon-picture" style="font-size: xx-large;color: grey; " onclick="upload()"></span><input type="file" name="myfile" id = "upload" style="display: none;"></label>
                       <button style = "float: right;" class="btn btn-primary">post</button>
                      
                    </form> 

                    <br><br>
                    {% endif %}
                     
                    {% if messages %}
                       {% for message in messages %}
                       <div class="alert alert-{{ message.tags }}">
                           {{ message }}
                       </div>
                       {% endfor %}
                    {% endif %}
                 




 <div class="infinite-container">
    {% for post in posts %}
     <div class="infinite-item">
              <div class="box">
                   <h3 style="font-family: 'Lobster', cursive;"><img class="img-circle" src="{{ post.author.profile.image.url }}" height="30px" width="35px" />
                   &nbsp{{ post.author }}</h3>
                   <small class="date"> at {{ post.created_date }}</small><hr>
                   <p>{{ post.title }}</p>
                   {% if post.post_pics %}

                     <img src="/media/{{ post.post_pics }}" style="width:-webkit-fill-available;" />

                   {% endif %}

                   <hr>
                    <p style="font-size: 18px;padding-left: 12px"><span class="glyphicon glyphicon-thumbs-up" style="padding-left: 12px"></span>
                    <label><span style="padding-left: 140px" onclick="showcomments({{post.pk}})" >comments : {{post.comments.count}}</span></label>
                    <span class="glyphicon glyphicon-share-alt" style="padding-left: 140px">share</span></p>

              </div>
              <div class="comment{{post.pk}}" style=" display: none;">
           <div class="commentbox" >
            {% for comment in post.comments.all %}
                 
                  <div class="comment">
                    <small class="date">{{ comment.created_date }}</small>
                    <p>comment by : <strong>{{ comment.author }}</strong></p>
                    
                    <p>{{ comment.text|linebreaks }}</p>
                  </div>
                   
          {% empty %}
                <p>No comments here yet :(</p>
          {% endfor %}
          
          <form name="myform" method="POST" action="{% url 'create_comment'  pk=post.pk %}" autocomplete="off" enctype="multipart/form-data">  
                        {% csrf_token %}
                       <input id="post"  type="text" name="comment"  placeholder="  write comments here !!!" /><br><br>
                     
                       <button style = "float: right;" class="btn btn-primary">comment</button>
                      
                    </form> 
        </div>
         </div>

       <br>
     </div>
    {% endfor %}
  </div>

   {% if posts.has_next %}
    <a class="infinite-more-link" href="?page={{ posts.next_page_number }}">More</a>
  {% endif %}


   <div class="loading" style="display: none;">
    Loading...
  </div>

  <script>
    var infinite = new Waypoint.Infinite({
      element: $('.infinite-container')[0],
      onBeforePageLoad: function () {
        $('.loading').show();
      },
      onAfterPageLoad: function ($items) {
        $('.loading').hide();
      }
    });
  </script>

    

                </div>
                <div class="col-md-3">
                  {% if user.is_authenticated %}
                    <div class="well">

                      <h2>Add Friends</h2>
                   
                      {% for user in users %}
                          {% if not user in friends %}
                        <a href="{% url 'view_profile_with_pk'  pk=user.pk %}">
                         <h4> <img class="img-circle" src="{{ user.profile.image.url }}" height="30px" width="35px" />&nbsp{{user.username}}<a href="{% url 'change_friends' operation='add' pk=user.pk %}">
                          <button type="button" class="btn btn-success btn-xs">Add Friend</button></a>
                        </h4></a>

                   
                      
                          {% endif %}
                      
                    {% endfor %}
                    <h2>Friends list</h2>
                     {% for friend in friends %}
                    <a href="{% url 'view_profile_with_pk'  pk=friend.pk %}"><h4> <img class="img-circle" src="{{ friend.profile.image.url }}" height="30px" width="35px" />&nbsp{{friend.username}}  <a href="{% url 'change_friends' operation='remove' pk=friend.pk %}">
                       <button type="button" class="btn btn-default  btn-xs">Remove Friend</button>
                    </a> </h4></a>

                    
                   
                    {% endfor %}
                    </div>
                    {% endif %}
                  </div>
                </div>
              
                </div>
                
            </div>
        </div>
       {% if user.is_authenticated %}


       {% else %}
        <div class="footer">
          <span>facebook</span>
        </div>
       {% endif %}
       
    </body>


</html>